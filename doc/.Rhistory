setwd("~/GitHub/demografia/doc")
DT<- read.table ("~/GitHub/demografia/data/residenti-et-sesso-regione-nascita_2011.csv" , header=T, sep=";",
stringsAsFactors=F)
DT<- read.table ("~/GitHub/demografia/data/residenti_sesso_regione_nascita_2011.csv" , header=T, sep=";",
stringsAsFactors=F)
DT<- read.table ("~/GitHub/demografia/data/residenti_sesso_regione_nascita_2011.csv" , header=T, sep=";",
stringsAsFactors=F)
str(DT)                                 # 29 aziende opedaliere
names(DT) <- c("eta" ,"sesso","regione", "nresidenti")
names(DT)                   # "id"      "cbranca" "bdescr"
head(DT)
DT$sesso<-as.factor(DT$sesso)
DT$regione<-as.factor(DT$regione)
str(DT)
names (DT$regione)
levels (DT$regione)
table (DT$regione)
levels (DT$regione)
qq<-levels (DT$regione)
fix(qq)
levels (DT$regione)<-qq
table (DT$regione)
fix(qq)
levels (DT$regione)<-qq
table (DT$regione)
barplot(table (DT$regione))
library (ggplot2)
ggplot(data=DT, aes(x=regione, fill="gold")) +
geom_bar(stat="bin",show_guide = F) + coord_flip() +
ggtitle("frequency of different regions")
ggplot(data=DT, aes(x=regione, fill=sesso)) +
geom_bar(stat="bin",show_guide = F) + coord_flip() +
ggtitle("frequenza presenza regioni")
ggplot(data=DT, aes(x=regione, fill=sesso)) +
geom_bar(stat="bin",show_guide = F) + coord_flip() +
ggtitle("frequenza presenza regioni") +
xlab("Regione") + ylab("n. osservazioni")
ggplot(data=DT, aes(x=regione, fill=sesso)) +
geom_bar(stat="bin",show_guide = F) + coord_flip() +
facet_grid(. ~ sesso) +
ggtitle("frequenza osservazioni per regione") +
xlab("Regione") + ylab("n. osservazioni")
ggplot(data=DT, aes(x=regione, fill=sesso)) +
geom_bar(stat="bin",show_guide = F, position=position_dodge() ) +
coord_flip()  +
ggtitle("frequenza osservazioni per regione") +
xlab("Regione") + ylab("n. osservazioni")
ggplot(data=DT, aes(x=regione, fill=sesso)) +
geom_bar(stat="bin", position=position_dodge() ) +
coord_flip()  +
ggtitle("frequenza osservazioni per regione") +
xlab("Regione") + ylab("n. osservazioni")
ggplot(data=DT, aes(x=regione, fill=sesso)) +
geom_bar(stat="bin" ) +
coord_flip()  +
ggtitle("frequenza osservazioni per regione") +
xlab("Regione") + ylab("n. osservazioni")
table (DT$regione, DT$sesso)
str(regsex)
regsex<-table (DT$regione, DT$sesso)
str(regsex)
regsex[,1]
regsex[,1] -regsex[,2]
diffregsex <- regsex[,1] -regsex[,2]
diffregsex
str(diffregsex)
as.data.frame(diffregsex)
difrgsex <- as.data.frame(diffregsex)
str(difrgsex)
names(difrgsex)
rownames(difrgsex)
drgsex <- cbind (rownames(difrgsex), difrgsex)
str(drgsex)
colnames(difrgsex)<- c("regione", "diff_FM")
difrgsex <- as.data.frame(diffregsex,stringsAsFactors=F )
drgsex <- cbind (rownames(difrgsex), difrgsex)
str(drgsex)
head(drgsex)
colnames(drgsex) <- c("regione", "diff_FM")
head(drgsex)
ggplot(data=drgsex, aes(x=regione, y= diff_FM)) +
geom_bar(stat="bin" ) +
coord_flip()  +
ggtitle("frequenza osservazioni per regione") +
xlab("Regione") + ylab("n. osservazioni")
ggplot(data=drgsex, aes(x=regione, y= diff_FM)) +
geom_bar(stat="identity" ) +
coord_flip()  +
ggtitle("frequenza osservazioni per regione") +
xlab("Regione") + ylab("n. osservazioni")
ggplot(data=drgsex, aes(x=regione, y= diff_FM, fill="gold")) +
geom_bar(stat="identity" ) +
coord_flip()  +
ggtitle("frequenza osservazioni per regione") +
xlab("Regione") + ylab("n. osservazioni")
ggplot(data=drgsex, aes(x=regione, y= diff_FM, fill="gold")) +
geom_bar(stat="identity" ) +
coord_flip()  +
ggtitle("differenza n.osservazioni F-M ") +
xlab("Regione") + ylab("F-M")
ggplot(data=drgsex, aes(x=regione, y= diff_FM, fill="gold")) +
geom_bar(stat="identity", show_guide = F ) +
coord_flip()  +
ggtitle("differenza n.osservazioni F-M ") +
xlab("Regione") + ylab("F-M")
ggplot(data=drgsex, aes(x=regione, y= diff_FM, fill="gold")) +
geom_bar(stat="identity", show_guide = F ) +
coord_flip()  +
ggtitle("differenza n.osservazioni fra sessi") +
xlab("Regione") + ylab("F-M")
ggplot(data=DT, aes(x=regione, fill=sesso)) +
geom_bar(stat="bin" ) +
coord_flip()  +
ggtitle("frequenza osservazioni per regione") +
xlab("Regione") + ylab("n. osservazioni")
ggplot(data=drgsex, aes(x=regione, y= diff_FM, fill="red")) +
geom_bar(stat="identity", show_guide = F ) +
coord_flip()  +
ggtitle("differenza n.osservazioni fra sessi") +
xlab("Regione") + ylab("F-M")
ggplot(data=drgsex, aes(x=regione, y= diff_FM, fill="#FF0000")) +
geom_bar(stat="identity", show_guide = F ) +
coord_flip()  +
ggtitle("differenza n.osservazioni fra sessi") +
xlab("Regione") + ylab("F-M")
ggplot(data=drgsex, aes(x=regione, y= diff_FM, fill=c("#FF0000"))) +
geom_bar(stat="identity", show_guide = F ) +
coord_flip()  +
ggtitle("differenza n.osservazioni fra sessi") +
xlab("Regione") + ylab("F-M")
ggplot(data=drgsex, aes(x=regione, y= diff_FM, fill="#CC6666" )) +
geom_bar(stat="identity", show_guide = F ) +
coord_flip()  +
ggtitle("differenza n.osservazioni fra sessi") +
xlab("Regione") + ylab("F-M")
ggplot(data=drgsex, aes(x=regione, y= diff_FM, fill= "#CC6666" )) +
geom_bar(stat="identity", show_guide = F, ymin= -5 ) +
coord_flip()  +
ggtitle("differenza n.osservazioni fra sessi") +
xlab("Regione") + ylab("F-M")
ggplot(data=drgsex, aes(x=regione, y= diff_FM )) +
geom_bar(stat="identity", show_guide = F, fill= "#CC6666") +
coord_flip()  +
ggtitle("differenza n.osservazioni fra sessi") +
xlab("Regione") + ylab("F-M")
ggplot(data=drgsex, aes(x=regione, y= diff_FM )) +
geom_bar(stat="identity", show_guide = F, fill= "#FF0000") +
coord_flip()  +
ggtitle("differenza n.osservazioni fra sessi") +
xlab("Regione") + ylab("F-M")
ggplot(data=drgsex, aes(x=regione, y= diff_FM )) +
geom_bar(stat="identity", show_guide = F, fill= "#FF0000") +
coord_flip()  +  + ylim(-7,7) +
ggtitle("differenza n.osservazioni fra sessi") +
xlab("Regione") + ylab("F-M")
ggplot(data=drgsex, aes(x=regione, y= diff_FM )) +
geom_bar(stat="identity", show_guide = F, fill= "#FF0000") +
coord_flip()  +  + ylim(7) +
ggtitle("differenza n.osservazioni fra sessi") +
xlab("Regione") + ylab("F-M")
ggplot(data=drgsex, aes(x=regione, y= diff_FM )) +
geom_bar(stat="identity", show_guide = F, fill= "#FF0000") +
coord_flip()  +  + ylim(-7, +7) +
ggtitle("differenza n.osservazioni fra sessi") +
xlab("Regione") + ylab("F-M")
ggplot(data=drgsex, aes(x=regione, y= diff_FM )) +
geom_bar(stat="identity", show_guide = F, fill= "#FF0000") +
coord_flip()  +   ylim(-7, 7) +
ggtitle("differenza n.osservazioni fra sessi") +
xlab("Regione") + ylab("F-M")
ggplot(data=drgsex, aes(x=regione, y= diff_FM )) +
geom_bar(stat="identity", show_guide = F, fill= "#FF0000") +
coord_flip()  +   ylim(-4, 7) +
ggtitle("differenza n.osservazioni fra sessi") +
xlab("Regione") + ylab("F-M")
ggplot(data=drgsex, aes(x=regione, y= diff_FM )) +
geom_bar(stat="identity", show_guide = F, fill= "#FF0000") +
coord_flip()  +   ylim(-7, 7) +
ggtitle("differenza n.osservazioni fra sessi") +
xlab("Regione") + ylab("F-M")
ggplot(data=drgsex, aes(x=regione, y= diff_FM )) +
geom_bar(stat="identity", show_guide = F, fill= "#FF0000") +
coord_flip()  +   ylim(-3, 7) +
ggtitle("differenza n.osservazioni fra sessi") +
xlab("Regione") + ylab("F-M")
ggplot(data=DT, aes(x=regione, fill=sesso)) +
geom_bar(stat="bin" ) +
coord_flip()  +
ggtitle("frequenza osservazioni per regione") +
xlab("Regione") + ylab("n. osservazioni")
ggplot(data=drgsex, aes(x=regione, y= diff_FM )) +
geom_bar(stat="identity", show_guide = F, fill= "#FF0000") +
coord_flip()  +   ylim(-3, 8) +
ggtitle("differenza n.osservazioni fra sessi") +
xlab("Regione") + ylab("F-M")
levels (DT$regione)
DT_Pie <- subset(DT, Regione ==  "Piemonte" )
DT_Pie <- subset(DT, regione ==  "Piemonte" )
str(DT_Pie)
ggplot(data=DT, aes(x=regione, y= nresidenti, fill=sesso)) +
geom_bar(stat="bin" ) +
coord_flip()  +
ggtitle("frequenza osservazioni per regione") +
xlab("Regione") + ylab("n. osservazioni")
ggplot(data=DT_Pie, aes(x=eta, y= nresidenti, fill=sesso)) +
geom_bar(stat="identity" ) +
ggtitle("distribuzione per eta in Piemonte") +
xlab("eta") + ylab("n. cittadini")
DT_EX <- subset(DT, regione ==  "ESTERO" )
str(DT_EX)
ggplot(data=DT_EX, aes(x=eta, y= nresidenti, fill=sesso)) +
geom_bar(stat="identity" ) +
ggtitle("distribuzione per eta nati all'estero") +
xlab("eta") + ylab("n. cittadini")
DT_si <- subset(DT, regione ==  "Sicilia" )
str(DT_si)
ggplot(data=DT_si, aes(x=eta, y= nresidenti, fill=sesso)) +
geom_bar(stat="identity" ) +
ggtitle("distribuzione per eta nati in Sicilia") +
xlab("eta") + ylab("n. cittadini")
DT_si <- subset(DT, regione ==  "Sicilia" )
str(DT_si)
DT_si <- subset(DT, regione ==  "Sicilia " )
str(DT_si)
ggplot(data=DT_si, aes(x=eta, y= nresidenti, fill=sesso)) +
geom_bar(stat="identity" ) +
ggtitle("distribuzione per eta nati in Sicilia") +
xlab("eta") + ylab("n. cittadini")
library (plyr)
DTtot<-ddply(DT, .(regione,sesso), summarise,
qta= sum(nresidenti))
str(DTtot)
head(DTtot)
ggplot(data=DTtot, aes(x=regione, y= qta )) +
geom_bar(stat="identity", show_guide = F, fill= sesso) +
coord_flip() +
ggtitle("provenienza dei residenti") +
xlab("Regione") + ylab("n. residenti")
ggplot(data=DTtot, aes(x=regione, y= qta, fill = sesso )) +
geom_bar(stat="identity", show_guide = F) +
coord_flip() +
ggtitle("provenienza dei residenti") +
xlab("Regione") + ylab("n. residenti")
ggplot(data=DTtot, aes(x=regione, y= qta/1000, fill = sesso )) +
geom_bar(stat="identity", show_guide = F) +
coord_flip() +
ggtitle("provenienza dei residenti") +
xlab("Regione") + ylab("in migliaia")
ggplot(data=DT_tot_noPie, aes(x=regione, y= qta/1000, fill = sesso )) +
geom_bar(stat="identity", show_guide = F) +
coord_flip() +
ggtitle("provenienza dei residenti (senza piemontesi)") +
xlab("Regione") + ylab("in migliaia")
DT_tot_noPie <- subset(DT, regione !=  "Piemonte" )
ggplot(data=DT_tot_noPie, aes(x=regione, y= qta/1000, fill = sesso )) +
geom_bar(stat="identity", show_guide = F) +
coord_flip() +
ggtitle("provenienza dei residenti (senza piemontesi)") +
xlab("Regione") + ylab("in migliaia")
DT_tot_noPie <- subset(DTtot, regione !=  "Piemonte" )
ggplot(data=DT_tot_noPie, aes(x=regione, y= qta/1000, fill = sesso )) +
geom_bar(stat="identity", show_guide = F) +
coord_flip() +
ggtitle("provenienza dei residenti (senza piemontesi)") +
xlab("Regione") + ylab("in migliaia")
DT_Pie <- subset(DT, regione ==  "Piemonte" )
str(DT_Pie)
ggplot(data=DT_Pie, aes(x=eta, y= nresidenti, fill=sesso)) +
geom_bar(stat="identity" ) +
ggtitle("distribuzione per eta nati in Piemonte") +
xlab("eta") + ylab("n. cittadini")
DT_EX <- subset(DT, regione ==  "ESTERO" )
str(DT_EX)
ggplot(data=DT_EX, aes(x=eta, y= nresidenti, fill=sesso)) +
geom_bar(stat="identity" ) +
ggtitle("distribuzione per eta nati all'estero") +
xlab("eta") + ylab("n. cittadini")
DT_si <- subset(DT, regione ==  "Sicilia " )
str(DT_si)
ggplot(data=DT_si, aes(x=eta, y= nresidenti, fill=sesso)) +
geom_bar(stat="identity" ) +
ggtitle("distribuzione per eta nati in Sicilia") +
xlab("eta") + ylab("n. cittadini")
DT_pu <- subset(DT, regione ==  "Puglia " )
str(DT_pu)
ggplot(data=DT_pu, aes(x=eta, y= nresidenti, fill=sesso)) +
geom_bar(stat="identity" ) +
ggtitle("distribuzione per eta nati in Puglia") +
xlab("eta") + ylab("n. cittadini")
levels (DTtot$regione)
head(DTtot)
sapply(myregione, function(x) DTtot$qta[DTtot$regione==x & DTtot$sesso=="F"]  - DTtot$qta[DTtot$regione==x & DTtot$sesso=="M"]  )
myregione<-levels (DTtot$regione)
sapply(myregione, function(x) DTtot$qta[DTtot$regione==x & DTtot$sesso=="F"]  - DTtot$qta[DTtot$regione==x & DTtot$sesso=="M"]  )
sapply(myregione,
function(x) DTtot$qta[DTtot$regione==x & DTtot$sesso=="F"]  - DTtot$qta[DTtot$regione==x & DTtot$sesso=="M"]  )
dsex<-sapply(myregione,
function(x) DTtot$qta[DTtot$regione==x & DTtot$sesso=="F"]  - DTtot$qta[DTtot$regione==x & DTtot$sesso=="M"]  )
str(dsex)
d_sex <- cbind (rownames(dsex), dsex)
str(d_sex)
d_sex<- as.data.frame(dsex)
str(d_sex)
head(d_sex)
d_sex <- cbind (rownames(dsex), dsex)
str(d_sex)
head(d_sex)
colnames(d_sex) <- c("regione", "diff_FM")
d_sex <- cbind (rownames(dsex), dsex)
str(d_sex)
head(d_sex)
dsex<-sapply(myregione,
function(x) DTtot$qta[DTtot$regione==x & DTtot$sesso=="F"]  - DTtot$qta[DTtot$regione==x & DTtot$sesso=="M"]  )
dsex
d_sex<- as.data.frame(dsex)
d_sex
d_sex <- cbind (rownames(d_sex), d_sex)
str(d_sex)
head(d_sex)
colnames(d_sex) <- c("regione", "diff_FM")
head(d_sex)
ggplot(data=d_sex, aes(x=regione, y= diff_FM )) +
geom_bar(stat="identity", show_guide = F, fill= "#FF0000") +
coord_flip()  +   ylim(-3, 7) +
ggtitle("differenza residenti fra sessi") +
xlab("Regione") + ylab("F-M")
head(d_sex)
d_sex
ggplot(data=d_sex, aes(x=regione, y= diff_FM )) +
geom_bar(stat="identity", show_guide = F, fill= "#FF0000") +
coord_flip()  +
ggtitle("differenza residenti fra sessi") +
xlab("Regione") + ylab("F-M")
dsex<-sapply(myregione,
function(x) DTtot$qta[DTtot$regione==x & DTtot$sesso=="F"]  - DTtot$qta[DTtot$regione==x & DTtot$sesso=="M"]  )
ssex<-sapply(myregione,
function(x) DTtot$qta[DTtot$regione==x & DTtot$sesso=="F"]  + DTtot$qta[DTtot$regione==x & DTtot$sesso=="M"]  )
dsex<-sapply(myregione,
function(x) DTtot$qta[DTtot$regione==x & DTtot$sesso=="F"]  - DTtot$qta[DTtot$regione==x & DTtot$sesso=="M"]  )
ssex<-sapply(myregione,
function(x) DTtot$qta[DTtot$regione==x & DTtot$sesso=="F"]  + DTtot$qta[DTtot$regione==x & DTtot$sesso=="M"]  )
d_sex<- as.data.frame(dsex)
s_sex<- as.data.frame(ssex)
d_sex <- cbind (rownames(d_sex), d_sex,s_sex)
str(d_sex)
head(d_sex)
psex <- dsex / ssex
psex
d_sex<- as.data.frame(dsex)
s_sex<- as.data.frame(ssex)
psex <- dsex / ssex
d_sex <- cbind (rownames(d_sex), d_sex, s_sex, psex)
str(d_sex)
head(d_sex)
d_sex<- as.data.frame(dsex)
s_sex<- as.data.frame(ssex)
psex <- round (dsex / ssex,2)
d_sex <- cbind (rownames(d_sex), d_sex, s_sex, psex)
str(d_sex)
head(d_sex)
colnames(d_sex) <- c("regione", "diff_FM", "perdiff")
head(d_sex)
colnames(d_sex) <- c("regione", "diff_FM", "total", perdiff")
ggplot(data=d_sex, aes(x=regione, y= diff_FM )) +
head(d_sex)
colnames(d_sex) <- c("regione", "diff_FM", "total", perdiff")
head(d_sex)
colnames(d_sex) <- c("regione", "diff_FM", "total", "perdiff")
head(d_sex)
ggplot(data=d_sex, aes(x=regione, y= diff_FM )) +
geom_bar(stat="identity", show_guide = F, fill= "#FF0000") +
coord_flip()  +
ggtitle("differenza residenti fra sessi") +
xlab("Regione") + ylab("F-M")
ggplot(data=d_sex, aes(x=regione, y= perdiff )) +
geom_bar(stat="identity", show_guide = F, fill= "#CC0000") +
coord_flip()  +
ggtitle("differenza percentuale F>M") +
xlab("Regione") + ylab("%")
ggplot(data=d_sex, aes(x=regione, y= perdiff )) +
geom_bar(stat="identity", show_guide = F, fill= "#AA0000") +
coord_flip()  +
ggtitle("differenza percentuale F>M") +
xlab("Regione") + ylab("%")
ggplot(data=d_sex, aes(x=regione, y= perdiff )) +
geom_bar(stat="identity", show_guide = F, fill= "#FFFF00") +
coord_flip()  +
ggtitle("differenza percentuale F>M") +
xlab("Regione") + ylab("%")
ggplot(data=d_sex, aes(x=regione, y= perdiff )) +
geom_bar(stat="identity", show_guide = F, fill= "#FFCC00") +
coord_flip()  +
ggtitle("differenza percentuale F>M") +
xlab("Regione") + ylab("%")
ggplot(data=DT, aes(x=regione, fill=sesso)) +
geom_bar(stat="bin" ) +
coord_flip()  +
ggtitle("frequenza osservazioni per regione") +
xlab("Regione") + ylab("n. osservazioni")
head(DT)
DT <- DT[order(DT$regione, DT$sesso, DT$eta),]
head(DT)
ggplot(data=DT, aes(x=regione, fill=sesso)) +
geom_bar(stat="bin" ) +
coord_flip()  +
ggtitle("frequenza osservazioni per regione") +
xlab("Regione") + ylab("n. osservazioni")
ggplot(data=drgsex, aes(x=regione, y= diff_FM )) +
geom_bar(stat="identity", show_guide = F, fill= "#FF0000") +
coord_flip()  +   ylim(-3, 7) +
ggtitle("differenza n.osservazioni fra sessi") +
xlab("Regione") + ylab("F-M")
DT_li <- subset(DT, regione ==  "Liguria " )
str(DT_li)
ggplot(data=DT_li, aes(x=eta, y= nresidenti, fill=sesso)) +
geom_bar(stat="identity" ) +
ggtitle("distribuzione per eta nati in Liguria") +
xlab("eta") + ylab("n. cittadini")
DT_li
str(DT_li)
table(DT_li$eta, DT_li$sesso)
es_li <- table(DT_li$eta, DT_li$sesso)
str(es_li)
es_li[1,1]
es_lidf <- as.data.frame(es_li)
es_lidf
es_li
dim(es_li)
dim(es_li)[1]
str(es_li)
es_li[103,1]
es_li[103,2]
rownames(es_li)
pippo<-NA
pippo
pippo<-matrix(0,dim(es_li)[1],2)
pippo<-matrix(0,dim(es_li)[1],2)
for (i in 1:dim(es_li)[1])
{
pippo[i,1] <- rownames(es_li)[i]
pippo[i,2] <- es_li)[i,1] - es_li)[i,2]
}
pippo<-matrix(0,dim(es_li)[1],2)
dim(pippo)
for (i in 1:dim(es_li)[1]) {
pippo[i,1] <- rownames(es_li)[i]
pippo[i,2] <- es_li)[i,1] - es_li)[i,2]
}
rownames(es_li)[1]
rownames(es_li)[103]
dim(es_li)[1]
for (i in 1:dim(es_li)[1])
{
pippo[i,1] <- rownames(es_li)[i]
pippo[i,2] <- es_li[i,1] - es_li[i,2]
}
which (pippo[,2]>0)
colnames(pippo)
str(pippo)
pippo[1,][which (pippo[,2]>0)]
pippo[1,which (pippo[,2]>0)]
pippo[,which (pippo[,2]>0)]
pippo[which (pippo[,2]>0),]
